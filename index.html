<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Messenger Supabase</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#111; color:#fff; }
header { background:#222; color:white; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.5em; }
nav { display:flex; gap:20px; }
nav ul { list-style:none; display:flex; gap:10px; margin:0; padding:0; overflow-x:auto; }
nav ul li { position:relative; }
nav ul li a { color:white; text-decoration:none; cursor:pointer; padding:5px; display:block; white-space:nowrap; }
nav ul li ul { display:none; position:absolute; top:30px; left:0; background-color:#333; padding:10px; border-radius:5px; min-width:150px; max-height:200px; overflow-y:auto; }
nav ul li:hover ul { display:block; }
nav ul li ul li { margin:0; }
nav ul li ul li a { color:white; }
footer { background:#222; color:white; text-align:center; padding:20px; }
.announcement-bar { background:#ffcc00; color:#000; padding:10px; overflow:hidden; white-space:nowrap; margin:2px 0; }
.announcement-bar2 { background:#00ccff; color:#000; padding:10px; overflow:hidden; white-space:nowrap; margin:2px 0; }
.announcement-text { display:inline-block; padding-left:100%; animation: marquee 15s linear infinite; }
@keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
.chat-container { padding:20px; }
.chat-message { background:#222; padding:10px; margin-bottom:10px; border-radius:5px; position:relative; word-break: break-word; }
.chat-message .actions { position:absolute; top:0; right:0; display:flex; gap:5px; }
.chat-message img, .chat-message video, .chat-message audio { max-width:100%; border-radius:5px; margin-top:5px; }
.chat-input { display:flex; gap:10px; margin-top:10px; }
.chat-input input { flex:1; padding:10px; border-radius:5px; border:1px solid #555; background:#111; color:#fff; }
.chat-input button { padding:10px 15px; border:none; border-radius:5px; background:#222; color:white; cursor:pointer; }
.group-list { margin-bottom:20px; }
.group { background:#222; padding:10px; margin-bottom:5px; border-radius:5px; display:flex; justify-content:space-between; align-items:center; }
.like-button { background:#444; border:none; padding:2px 5px; border-radius:3px; cursor:pointer; color:#fff; }
.like-button.liked { background:#ffcc00; color:#000; }
.admin-panel { margin:20px; padding:10px; background:#333; border-radius:5px; }
.admin-panel input, .admin-panel button { margin:5px 0; padding:5px; border-radius:3px; border:none; }
.scroll-menu { display:flex; overflow-x:auto; gap:5px; padding:5px 0; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.29.0/dist/supabase.min.js"></script>
</head>
<body>

<header>
<h1>Mini Messenger</h1>
<div id="timeDisplay">--:--:--</div>
<nav>
<ul id="mainMenu">
<li><a href="#">Menu</a>
<ul>
<li><a onclick="showSection('groups')">Groupes</a></li>
<li><a onclick="showSection('chat')">Chat</a></li>
</ul>
</li>
</ul>
</nav>
<nav>
<ul id="linkMenu" class="scroll-menu"></ul>
</nav>
</header>

<div id="announcementBar" class="announcement-bar"><span id="announcementText" class="announcement-text"></span></div>
<div id="announcementBar2" class="announcement-bar2"><span id="announcementText2" class="announcement-text"></span></div>

<section id="groups" class="chat-container">
<h2>Mes Groupes</h2>
<input type="text" id="searchGroup" placeholder="Rechercher un groupe..." onkeyup="searchGroups()">
<div class="group-list" id="groupList"></div>
<input type="text" id="newGroup" placeholder="Nom du nouveau groupe">
<button onclick="createGroup()">Cr√©er Groupe</button>
</section>

<section id="chat" class="chat-container" style="display:none;">
<h2 id="currentGroupTitle">Chat</h2>
<div id="chatMessages"></div>
<div class="chat-input">
<input type="text" id="chatInput" placeholder="√âcrire un message...">
<button onclick="sendMessage()">Envoyer</button>
<button onclick="addMedia()">üìé</button>
<input type="file" id="mediaInput" style="display:none;" accept="image/*,video/*,audio/*,.pdf" onchange="sendMedia(event)">
</div>
</section>

<div id="adminPanel" class="admin-panel" style="display:none;">
<h3>Admin - Gestion</h3>
<input type="text" id="targetUserId" placeholder="User ID √† bloquer/d√©bloquer">
<button onclick="blockUser()">Bloquer</button>
<button onclick="unblockUser()">D√©bloquer</button>
<div id="blockedList"></div>
<hr>
<input type="text" id="announcementInput" placeholder="Texte de l‚Äôannonce 1">
<button onclick="setAnnouncement()">Publier Annonce 1</button>
<button onclick="clearAnnouncement()">Supprimer Annonce 1</button>
<input type="text" id="announcementInput2" placeholder="Texte de l‚Äôannonce 2">
<button onclick="setAnnouncement2()">Publier Annonce 2</button>
<button onclick="clearAnnouncement2()">Supprimer Annonce 2</button>
<hr>
<input type="text" id="adminCodeInput" placeholder="Entrer code admin">
<button onclick="checkAdmin()">Valider code admin</button>
</div>

<footer>
&copy; 2025 Lesfacilitateurs. Tous droits r√©serv√©s.
</footer>

<script>
const SUPABASE_URL='https://chgyzvowfsblodxbagfa.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoZ3l6dm93ZnNibG9keGJhZ2ZhIiwicm9sIjoiYW5vbiIsImlhdCI6MTc1Nzc2MDYyNCwiZXhwIjoyMDczMzM2NjI0fQ.JEg_WFTJlB3gNBI8-oaP35N68tu9p6TGl6vM3sYPL4Y';
const supabase = supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let userId = localStorage.getItem('userId');
if(!userId){ userId='User'+Math.floor(Math.random()*10000); localStorage.setItem('userId',userId);}
let isUserAdmin=false;
let blockedUsers=[];
let groups=[];
let currentGroup=null;

function checkAdmin(){
  const code=document.getElementById('adminCodeInput').value.trim();
  if(code==='233233'){isUserAdmin=true; alert("Admin activ√© !"); document.getElementById('adminPanel').style.display='block'; loadLinks();}
  else alert("Code incorrect."); document.getElementById('adminCodeInput').value='';
}

function showSection(id){ document.getElementById('groups').style.display=id==='groups'?'block':'none'; document.getElementById('chat').style.display=id==='chat'?'block':'none'; }

function updateTime(){ const d=new Date(); document.getElementById('timeDisplay').textContent=d.toLocaleTimeString(); }
setInterval(updateTime,1000);

async function fetchGroups(){ let {data,error}=await supabase.from('groups').select('*'); if(error) console.log(error); else groups=data; renderGroups(); }

function renderGroups(){ const list=document.getElementById('groupList'); list.innerHTML=''; groups.forEach((g,i)=>{ const div=document.createElement('div'); div.className='group'; div.innerHTML=`<span style="cursor:pointer">${g.name} [${g.members?g.members.length:0}]</span>`; div.querySelector('span').onclick=()=>openGroup(i); list.appendChild(div); }); }

function searchGroups(){ const val=document.getElementById('searchGroup').value.toLowerCase(); const filtered=groups.filter(g=>g.name.toLowerCase().includes(val)); const list=document.getElementById('groupList'); list.innerHTML=''; filtered.forEach((g,i)=>{ const div=document.createElement('div'); div.className='group'; div.innerHTML=`<span style="cursor:pointer">${g.name} [${g.members?g.members.length:0}]</span>`; div.querySelector('span').onclick=()=>openGroup(groups.indexOf(g)); list.appendChild(div); }); }

async function createGroup(){ const name=document.getElementById('newGroup').value.trim(); if(!name) return; let {data,error}=await supabase.from('groups').insert([{name,messages:[],members:[userId]}]); if(error) console.log(error); else{ groups.push(data[0]); renderGroups(); document.getElementById('newGroup').value=''; }}

async function openGroup(i){ currentGroup=i; showSection('chat'); document.getElementById('currentGroupTitle').textContent=groups[i].name; if(!groups[i].members.includes(userId)){ groups[i].members.push(userId); await supabase.from('groups').update({members:groups[i].members}).eq('id',groups[i].id); renderGroups(); } renderMessages(); }

async function sendMessage(){ if(currentGroup===null) return; const input=document.getElementById('chatInput'); if(!input.value.trim()) return; const msg={id:Date.now(),user:userId,text:input.value,media:null,likes:0,likedBy:[],timestamp:Date.now()}; groups[currentGroup].messages.push(msg); await supabase.from('groups').update({messages:groups[currentGroup].messages}).eq('id',groups[currentGroup].id); input.value=''; renderMessages(); }

function renderMessages(){ if(currentGroup===null) return; const container=document.getElementById('chatMessages'); container.innerHTML=''; groups[currentGroup].messages.forEach((m,i)=>{ const div=document.createElement('div'); div.className='chat-message'; let mediaHtml=''; if(m.media){ if(m.media.type.startsWith('image')) mediaHtml=`<img src="${m.media.url}">`; else if(m.media.type.startsWith('video')) mediaHtml=`<video src="${m.media.url}" controls></video>`; else if(m.media.type.startsWith('audio')) mediaHtml=`<audio controls src="${m.media.url}"></audio>`; else mediaHtml=`<a href="${m.media.url}" target="_blank">Fichier</a>`; } div.innerHTML=`<strong>${m.user}</strong>: ${m.text||''} ${mediaHtml} <button class="like-button ${m.likedBy?.includes(userId)?'liked':''}" onclick="likeMessage(${i})">‚ù§ ${m.likes||0}</button>`; if(m.user===userId||isUserAdmin){ const actions=document.createElement('div'); actions.className='actions'; const editBtn=document.createElement('button'); editBtn.textContent='‚úèÔ∏è'; editBtn.onclick=()=>{ const t=prompt('Modifier message',m.text); if(t!==null){ m.text=t; supabase.from('groups').update({messages:groups[currentGroup].messages}).eq('id',groups[currentGroup].id); renderMessages(); } }; const delBtn=document.createElement('button'); delBtn.textContent='üóëÔ∏è'; delBtn.onclick=()=>{ groups[currentGroup].messages.splice(i,1); supabase.from('groups').update({messages:groups[currentGroup].messages}).eq('id',groups[currentGroup].id); renderMessages(); }; actions.appendChild(editBtn); actions.appendChild(delBtn); div.appendChild(actions); } container.appendChild(div); }); container.scrollTop=container.scrollHeight; }

function likeMessage(i){ const m=groups[currentGroup].messages[i]; if(!m.likedBy.includes(userId)){ m.likes++; m.likedBy.push(userId); }else{ m.likes--; m.likedBy=m.likedBy.filter(u=>u!==userId); } supabase.from('groups').update({messages:groups[currentGroup].messages}).eq('id',groups[currentGroup].id); renderMessages(); }

function addMedia(){ document.getElementById('mediaInput').click(); }
function sendMedia(e){ const file=e.target.files[0]; if(!file||currentGroup===null) return; const reader=new FileReader(); reader.onload=async ev=>{ const msg={id:Date.now(),user:userId,text:'',media:{url:ev.target.result,type:file.type},likes:0,likedBy:[],timestamp:Date.now()}; groups[currentGroup].messages.push(msg); await supabase.from('groups').update({messages:groups[currentGroup].messages}).eq('id',groups[currentGroup].id); renderMessages(); }; reader.readAsDataURL(file); }

function blockUser(){ const t=document.getElementById('targetUserId').value.trim(); if(t&&!blockedUsers.includes(t)){ blockedUsers.push(t); localStorage.setItem('blockedUsers',JSON.stringify(blockedUsers)); updateBlockedList(); } }
function unblockUser(){ const t=document.getElementById('targetUserId').value.trim(); blockedUsers=blockedUsers.filter(u=>u!==t); localStorage.setItem('blockedUsers',JSON.stringify(blockedUsers)); updateBlockedList(); }
function updateBlockedList(){ document.getElementById('blockedList').textContent = blockedUsers.length ? "Bloqu√©s: "+blockedUsers.join(','):"Aucun utilisateur bloqu√©"; }

function setAnnouncement(){ globalAnnouncement=document.getElementById('announcementInput').value.trim(); document.getElementById('announcementText').textContent=globalAnnouncement; }
function clearAnnouncement(){ globalAnnouncement=''; document.getElementById('announcementText').textContent=''; }
function setAnnouncement2(){ globalAnnouncement2=document.getElementById('announcementInput2').value.trim(); document.getElementById('announcementText2').textContent=globalAnnouncement2; }
function clearAnnouncement2(){ globalAnnouncement2=''; document.getElementById('announcementText2').textContent=''; }

function searchGroups(){ const val=document.getElementById('searchGroup').value.toLowerCase(); const list=document.getElementById('groupList'); list.innerHTML=''; groups.filter(g=>g.name.toLowerCase().includes(val)).forEach((g,i)=>{ const div=document.createElement('div'); div.className='group'; div.innerHTML=`<span style="cursor:pointer">${g.name} [${g.members?g.members.length:0}]</span>`; div.querySelector('span').onclick=()=>openGroup(i); list.appendChild(div); }); }

function loadLinks(){ const menu=document.getElementById('linkMenu'); menu.innerHTML=''; ['Lien1','Lien2','Lien3'].forEach(l=>{ const li=document.createElement('li'); li.innerHTML=`<a href="#">${l}</a>`; menu.appendChild(li); }); }

fetchGroups();
updateTime();
</script>
</body>
</html>