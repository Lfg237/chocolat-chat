<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bureau de Documents</title>
<style>
body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 0;
}
header {
    background: #00695c;
    color: #fff;
    text-align: center;
    padding: 15px;
    font-size: 22px;
    font-weight: bold;
}
nav {
    display: flex;
    background: #004d40;
}
nav button {
    flex: 1;
    padding: 12px;
    border: none;
    background: #004d40;
    color: white;
    cursor: pointer;
    font-weight: bold;
}
nav button.active {
    background: #00796b;
}
section {
    display: none;
    padding: 20px;
    margin: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
section.active {display: block;}
#cvDoc {background: #fff3e0; border-left: 8px solid #ff6f00;}
#lettreDoc {background: #e8f5e9; border-left: 8px solid #43a047;}
#planDoc {background: #e3f2fd; border-left: 8px solid #1e88e5;}
h2 {margin-top: 0; color: #333;}
input, textarea {
    width: 100%; padding: 8px; margin: 6px 0;
    border: 2px solid #1e88e5; border-radius: 8px;
}
button.primary {
    background: linear-gradient(45deg,#00c853,#b2ff59);
    color: #fff; font-weight: bold;
    border: none; padding: 10px 15px;
    border-radius: 8px; margin-top: 10px;
    cursor: pointer;
}
.cv-photo-preview {
    width: 130px; height: 130px;
    border: 3px dashed #ff6f00;
    border-radius: 50%;
    margin: 0 auto 10px auto;
    background-size: cover;
    background-position: center;
    display: flex; align-items: center; justify-content: center;
    color: #ff6f00; font-size: 13px; font-weight: bold;
}
canvas.signature-canvas {
    border: 2px solid #43a047;
    border-radius: 5px;
    width: 100%; height: 100px;
    margin-top: 10px;
}
.flex-row {display: flex; gap: 10px; justify-content: space-between;}
/* Popup */
#popupOverlay {
    display:none; position:fixed; inset:0;
    background:rgba(0,0,0,0.6);
    justify-content:center; align-items:center; z-index:9999;
}
#popup {
    border:3px solid #1e88e5; background:#fffde7;
    padding:15px; border-radius:10px;
    width:100%; max-width:400px;
}
#popup h2 {margin-top:0;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<header>üìë Bureau de Documents</header>
<nav>
    <button class="active" onclick="showSection('cvDoc',this)">CV</button>
    <button onclick="showSection('lettreDoc',this)">Lettre</button>
    <button onclick="showSection('planDoc',this)">Plan</button>
</nav>

<!-- CV -->
<section id="cvDoc" class="active">
<h2>üìÑ CV</h2>
<div class="cv-photo-preview" id="cvPhotoPreview">Importer photo</div>
<input type="file" id="cvPhotoInput" accept="image/*">
<h3 id="cvName" style="text-align:center;font-weight:bold;font-size:20px;">Nom Complet</h3>
<p id="cvProfession" style="text-align:center;">Profession</p>
<input id="cvPrenom" placeholder="Pr√©nom" value="Jean">
<input id="cvNom" placeholder="Nom" value="Dupont">
<input id="cvAge" placeholder="√Çge" value="30 ans">
<input id="cvVille" placeholder="Ville" value="Yaound√©">
<input id="cvQuartier" placeholder="Quartier" value="Bastos">
<input id="cvSituation" placeholder="Situation matrimoniale" value="C√©libataire">
<input id="cvPoste" placeholder="Poste" value="D√©veloppeur Web">
<input id="cvDiplome" placeholder="Dipl√¥me" value="Licence en Informatique">
<input id="cvEtablissement" placeholder="√âtablissement" value="Universit√© de Douala">
<input id="cvEmail" placeholder="Email" value="jean.dupont@mail.com">
<input id="cvTelMtn" placeholder="Tel MTN" value="+237 670000000">
<input id="cvTelOrange" placeholder="Tel Orange" value="+237 690000000">
<canvas id="cvCanvas" class="signature-canvas"></canvas>
<div class="flex-row">
<button class="primary" onclick="openPaymentPopup('cvDoc','pdf')">üìÑ T√©l√©charger PDF</button>
<button class="primary" onclick="openPaymentPopup('cvDoc','wa')">üì§ Partager WhatsApp</button>
</div>
</section>

<!-- Lettre -->
<section id="lettreDoc">
<h2>‚úâÔ∏è Lettre de Motivation</h2>
<input id="lettreNom" placeholder="Nom" value="Dupont">
<input id="lettreEntreprise" placeholder="Entreprise" value="TechCorp">
<input id="lettrePoste" placeholder="Poste souhait√©" value="D√©veloppeur">
<textarea id="lettreContenu" rows="6">Je vous √©cris afin de postuler au poste...</textarea>
<canvas id="lettreCanvas" class="signature-canvas"></canvas>
<div class="flex-row">
<button class="primary" onclick="openPaymentPopup('lettreDoc','pdf')">üìÑ T√©l√©charger PDF</button>
<button class="primary" onclick="openPaymentPopup('lettreDoc','wa')">üì§ Partager WhatsApp</button>
</div>
</section>

<!-- Plan -->
<section id="planDoc">
<h2>üó∫Ô∏è Plan de Localisation</h2>
<textarea id="planContenu" rows="6">Dessinez ou d√©crivez ici le plan de localisation...</textarea>
<canvas id="planCanvas" class="signature-canvas"></canvas>
<div class="flex-row">
<button class="primary" onclick="openPaymentPopup('planDoc','pdf')">üìÑ T√©l√©charger PDF</button>
<button class="primary" onclick="openPaymentPopup('planDoc','wa')">üì§ Partager WhatsApp</button>
</div>
</section>

<!-- Popup -->
<div id="popupOverlay">
<div id="popup">
<h2>Paiement requis</h2>
<p>B√©n√©ficiaire: Wirnkar Loveline</p>
<p>Num√©ros: MTN +237 670000000 | Orange +237 690000000</p>
<p>Prix unitaire: <span id="unitPrice">100</span> FCFA / heure</p>
<div class="flex-row">
<label>Multiplier: <span id="multiplierDisplay">1</span></label>
<button onclick="incrementMultiplier()">+</button>
</div>
<p>Total √† payer: <span id="totalPrice">100</span> FCFA</p>
<textarea id="momoMsg" placeholder="Message Mobile Money"></textarea>
<input id="transactionId" placeholder="ID de transaction">
<input id="adminCode" type="password" placeholder="Code admin">
<div id="popupResult"></div>
<div class="flex-row">
<button class="primary" onclick="validatePayment()">‚úÖ Valider</button>
<button onclick="closePopup()">Annuler</button>
</div>
</div>
</div>

<script>
// ====== Navigation ======
function showSection(id,btn){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}
// ===== Signature =====
function initSignatureCanvas(canvasId){
  const canvas=document.getElementById(canvasId); if(!canvas) return;
  const ctx=canvas.getContext('2d'); ctx.lineWidth=2; ctx.lineCap='round';
  let drawing=false;
  function getPos(e){const rect=canvas.getBoundingClientRect();
    if(e.touches&&e.touches.length){return {x:e.touches[0].clientX-rect.left,y:e.touches[0].clientY-rect.top};}
    return {x:e.clientX-rect.left,y:e.clientY-rect.top};}
  function start(e){drawing=true;const p=getPos(e);ctx.beginPath();ctx.moveTo(p.x,p.y);e.preventDefault?.();}
  function move(e){if(!drawing)return;const p=getPos(e);ctx.lineTo(p.x,p.y);ctx.stroke();ctx.beginPath();ctx.moveTo(p.x,p.y);e.preventDefault?.();}
  function end(){drawing=false;ctx.beginPath();}
  canvas.addEventListener('mousedown',start);canvas.addEventListener('mousemove',move);
  canvas.addEventListener('mouseup',end);canvas.addEventListener('mouseleave',end);
  canvas.addEventListener('touchstart',start,{passive:false});canvas.addEventListener('touchmove',move,{passive:false});canvas.addEventListener('touchend',end);
}
['cvCanvas','lettreCanvas','planCanvas'].forEach(initSignatureCanvas);

// ===== Photo CV =====
document.getElementById('cvPhotoInput').addEventListener('change',(e)=>{
  const file=e.target.files[0]; if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{document.getElementById('cvPhotoPreview').style.backgroundImage=`url(${ev.target.result})`;document.getElementById('cvPhotoPreview').textContent='';};
  reader.readAsDataURL(file);
});

// ===== Popup paiement =====
const ADMIN_CODE='xz233233'; const UNIT_PRICE=100;
let multiplier=1, currentDocId='', currentAction='';
function incrementMultiplier(){multiplier++;updatePopup();}
function updatePopup(){
  document.getElementById('multiplierDisplay').innerText=multiplier;
  document.getElementById('totalPrice').innerText=UNIT_PRICE*multiplier;
}
function openPaymentPopup(docId,action){
  currentDocId=docId; currentAction=action; multiplier=1; updatePopup();
  document.getElementById('momoMsg').value='';document.getElementById('transactionId').value='';document.getElementById('adminCode').value='';
  document.getElementById('popupResult').innerHTML='';
  document.getElementById('popupOverlay').style.display='flex';
}
function closePopup(){document.getElementById('popupOverlay').style.display='none';}
function validatePayment(){
  const admin=document.getElementById('adminCode').value.trim();
  if(admin===ADMIN_CODE){proceedAction();return;}
  const msg=document.getElementById('momoMsg').value.trim();
  const tx=document.getElementById('transactionId').value.trim();
  if(!msg||!tx){document.getElementById('popupResult').innerHTML="<span style='color:red'>Message et ID requis.</span>";return;}
  if(!msg.includes("Wirnkar")){document.getElementById('popupResult').innerHTML="<span style='color:red'>B√©n√©ficiaire incorrect.</span>";return;}
  const amount=UNIT_PRICE*multiplier;
  if(!msg.includes(amount)){document.getElementById('popupResult').innerHTML="<span style='color:red'>Montant incorrect.</span>";return;}
  proceedAction();
}
function proceedAction(){
  closePopup();
  const doc=document.getElementById(currentDocId);
  if(currentAction==='pdf') generatePDF(doc,currentDocId);
  else if(currentAction==='wa') shareWhatsApp(doc);
}

// ===== PDF & WhatsApp =====
function generatePDF(element,docIdForName){
  const clone=element.cloneNode(true);
  clone.querySelectorAll("button").forEach(b=>b.remove());
  html2canvas(clone,{scale:2}).then(canvas=>{
    const img=canvas.toDataURL('image/png');
    const {jsPDF}=window.jspdf;
    const pdf=new jsPDF('p','mm','a4');
    const w=pdf.internal.pageSize.getWidth();
    const h=(canvas.height* w)/canvas.width;
    pdf.addImage(img,'PNG',0,0,w,h);
    pdf.save(docIdForName+'.pdf');
  });
}
function shareWhatsApp(element){
  const text=element.innerText.slice(0,500);
  const url=`https://wa.me/?text=${encodeURIComponent(text)}`;
  window.open(url,'_blank');
}
</script>
</body>
</html>