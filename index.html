<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mes Documents A5</title>
<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: #e0f7fa;
  margin: 0;
  padding: 10px;
}
h1 {text-align:center; color:#00695c; font-size:26px; margin-bottom:15px;}
section {
  padding: 15px;
  border-radius: 12px;
  margin: 10px auto;
  max-width: 140mm; /* lÃ©gÃ¨rement infÃ©rieur Ã  A5 largeur 148mm */
  background:#fff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
#cvDoc {background: #fff3e0; border-left: 6px solid #ff6f00;}
#lettreDoc {background: #e8f5e9; border-left: 6px solid #43a047;}
#planDoc {background: #e3f2fd; border-left: 6px solid #1e88e5;}

.flex-row {display:flex; justify-content:space-between; align-items:center; margin-top:8px; gap:8px;}

.photo-preview {
  width: 90px; height: 90px;
  border: 2px dashed #ff6f00;
  border-radius: 50%;
  background-size: cover;
  background-position: center;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: #ff6f00;
  font-weight: bold;
  cursor:pointer;
}

input, textarea {
  width: 100%;
  padding: 6px;
  margin: 4px 0;
  border: 1.5px solid #1e88e5;
  border-radius: 6px;
  font-size: 13px;
}

canvas.signature-canvas {
  border: 1.5px solid #43a047;
  border-radius: 5px;
  width: 100%;
  height: 80px;
}

/* Popup paiement */
#popupOverlay {
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,0.6);
  justify-content:center; align-items:center; z-index:9999;
}
#popup {
  border:3px solid #1e88e5; background:#fffde7; padding:15px;
  border-radius:10px; width:100%; max-width:400px;
}
button.primary {
  background: linear-gradient(45deg,#00c853,#b2ff59);
  color: #fff; font-weight:bold; border:none; padding:8px; border-radius:6px; cursor:pointer;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h1>ðŸ“„ Mes Documents A5</h1>

<!-- ===== CV ===== -->
<section id="cvDoc">
<h2>CV</h2>
<div style="display:flex; gap:10px; align-items:flex-start;">
  <div class="photo-preview" id="cvPhotoPreview">Cliquer pour photo</div>
  <div style="flex:1;">
    <input id="cvPrenom" placeholder="PrÃ©nom">
    <input id="cvNom" placeholder="Nom">
    <input id="cvProfession" placeholder="Profession">
    <input id="cvVille" placeholder="Ville">
    <input id="cvQuartier" placeholder="Quartier">
    <input id="cvEmail" placeholder="Email">
    <input id="cvTelMtn" placeholder="Tel MTN">
    <input id="cvTelOrange" placeholder="Tel Orange">
  </div>
</div>
<canvas id="cvCanvas" class="signature-canvas"></canvas>
<div class="flex-row">
  <button class="primary" onclick="openPaymentPopup('cvDoc','pdf')">ðŸ“„ TÃ©lÃ©charger PDF</button>
  <button class="primary" onclick="openPaymentPopup('cvDoc','word')">ðŸ“„ TÃ©lÃ©charger Word</button>
</div>
<input type="file" id="cvPhotoInput" accept="image/*" style="display:none">
</section>

<!-- ===== Lettre ===== -->
<section id="lettreDoc">
<h2>Lettre de motivation</h2>
<div style="display:flex; gap:10px; align-items:flex-start;">
  <div class="photo-preview" id="lettrePhotoPreview">Cliquer pour photo</div>
  <div style="flex:1;">
    <input id="lettreNom" placeholder="Nom">
    <input id="lettrePrenom" placeholder="PrÃ©nom">
    <input id="lettrePoste" placeholder="Poste souhaitÃ©">
    <textarea id="lettreTexte" placeholder="Ã‰crire votre lettre ici..." rows="6"></textarea>
  </div>
</div>
<canvas id="lettreCanvas" class="signature-canvas"></canvas>
<div class="flex-row">
  <button class="primary" onclick="openPaymentPopup('lettreDoc','pdf')">ðŸ“„ TÃ©lÃ©charger PDF</button>
  <button class="primary" onclick="openPaymentPopup('lettreDoc','word')">ðŸ“„ TÃ©lÃ©charger Word</button>
</div>
<input type="file" id="lettrePhotoInput" accept="image/*" style="display:none">
</section>

<!-- ===== Plan ===== -->
<section id="planDoc">
<h2>Plan manuscrit</h2>
<textarea id="planTexte" placeholder="Dessinez ou dÃ©crivez votre plan..." rows="8"></textarea>
<div class="flex-row">
  <button class="primary" onclick="openPaymentPopup('planDoc','pdf')">ðŸ“„ TÃ©lÃ©charger PDF</button>
  <button class="primary" onclick="openPaymentPopup('planDoc','word')">ðŸ“„ TÃ©lÃ©charger Word</button>
</div>
</section>

<!-- ===== Popup paiement ===== -->
<div id="popupOverlay">
  <div id="popup">
    <h2>Paiement requis</h2>
    <p>BÃ©nÃ©ficiaire: Wirnkar Loveline</p>
    <p>NumÃ©ros: MTN 676353859 / Orange 640647072</p>
    <p>Montant unitaire: 100 FCFA / heure</p>
    <div class="flex-row">
      <label>Multiplier: <span id="multiplierDisplay">1</span></label>
      <button onclick="incrementMultiplier()">+</button>
      <button onclick="decrementMultiplier()">-</button>
    </div>
    <p>Total: <span id="totalAmount">100</span> FCFA</p>
    <textarea id="momoMsg" placeholder="Message Mobile Money"></textarea>
    <input id="transactionId" placeholder="ID de transaction">
    <input id="adminCode" type="password" placeholder="Code admin">
    <div id="popupResult"></div>
    <p>Temps restant: <span id="remainingTime">0 min</span></p>
    <div class="flex-row">
      <button class="primary" onclick="validatePayment()">âœ… Valider</button>
      <button onclick="closePopup()">Annuler</button>
    </div>
  </div>
</div>

<script>
const ADMIN_CODE='xz233233';
const UNIT_PRICE=100;
const PAYMENT_BENEF='Wirnkar Loveline';
let multiplier=1, currentDocId='', currentAction='';

function initSignatureCanvas(canvasId){
  const canvas=document.getElementById(canvasId);
  if(!canvas) return;
  const ctx=canvas.getContext('2d'); ctx.lineWidth=2; ctx.lineCap='round';
  let drawing=false;
  function getPos(e){
    const rect=canvas.getBoundingClientRect();
    if(e.touches && e.touches.length) return {x:e.touches[0].clientX-rect.left, y:e.touches[0].clientY-rect.top};
    return {x:e.clientX-rect.left, y:e.clientY-rect.top};
  }
  function start(e){drawing=true; const p=getPos(e); ctx.beginPath(); ctx.moveTo(p.x,p.y); e.preventDefault?.();}
  function move(e){if(!drawing) return; const p=getPos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(p.x,p.y); e.preventDefault?.();}
  function end(){drawing=false; ctx.beginPath();}
  canvas.addEventListener('mousedown',start); canvas.addEventListener('mousemove',move);
  canvas.addEventListener('mouseup',end); canvas.addEventListener('mouseleave',end);
  canvas.addEventListener('touchstart',start,{passive:false});
  canvas.addEventListener('touchmove',move,{passive:false});
  canvas.addEventListener('touchend',end);
}
initSignatureCanvas('cvCanvas');
initSignatureCanvas('lettreCanvas');

function initPhotoPreview(photoId, inputId){
  const photoPreview=document.getElementById(photoId);
  const photoInput=document.getElementById(inputId);
  photoPreview.addEventListener('click',()=>photoInput.click());
  photoInput.addEventListener('change', (e)=>{
    const file=e.target.files?.[0]; if(!file) return;
    const reader=new FileReader();
    reader.onload=ev=>{
      photoPreview.style.backgroundImage=`url(${ev.target.result})`;
      photoPreview.textContent='';
    };
    reader.readAsDataURL(file);
  });
}
initPhotoPreview('cvPhotoPreview','cvPhotoInput');
initPhotoPreview('lettrePhotoPreview','lettrePhotoInput');

function incrementMultiplier(){ multiplier++; updatePopup(); }
function decrementMultiplier(){ if(multiplier>1){multiplier--; updatePopup();} }
function updatePopup(){document.getElementById('multiplierDisplay').innerText=multiplier; document.getElementById('totalAmount').innerText=multiplier*UNIT_PRICE;}
function resetMultiplier(){multiplier=1; updatePopup();}
function openPaymentPopup(docId,action){currentDocId=docId; currentAction=action; resetMultiplier(); document.getElementById('momoMsg').value=''; document.getElementById('transactionId').value=''; document.getElementById('adminCode').value=''; document.getElementById('popupResult').innerHTML=''; document.getElementById('popupOverlay').style.display='flex';}
function closePopup(){document.getElementById('popupOverlay').style.display='none'; resetMultiplier();}

function validatePayment(){
  const admin=document.getElementById('adminCode').value.trim();
  if(admin===ADMIN_CODE){ document.getElementById('popupResult').innerHTML='<span style="color:green">Code admin acceptÃ© âœ…</span>'; setTimeout(()=>{proceedAction(); closePopup();},500); return;}
  const msg=document.getElementById('momoMsg').value.trim();
  const txId=document.getElementById('transactionId').value.trim();
  if(!msg||!txId){ document.getElementById('popupResult').innerHTML='<span style="color:red">Merci dâ€™entrer le message Mobile Money et lâ€™ID.</span>'; return;}
  if(!msg.toLowerCase().includes(PAYMENT_BENEF.toLowerCase())){ document.getElementById('popupResult').innerHTML='<span style="color:red">Nom bÃ©nÃ©ficiaire non trouvÃ©.</span>'; return;}
  const amountMatch=msg.match(/(\d+)/); 
  const expectedAmount=UNIT_PRICE*multiplier;
  if(!amountMatch || parseInt(amountMatch[1],10)!==expectedAmount){ document.getElementById('popupResult').innerHTML=`<span style="color:red">Montant incorrect (attendu ${expectedAmount} FCFA)</span>`; return;}
  proceedAction(); closePopup();
}

function proceedAction(){
  const doc=document.getElementById(currentDocId);
  if(currentAction==='pdf'){
    html2canvas(doc, {scale:2}).then(canvas=>{
      const imgData=canvas.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf=new jsPDF('p','mm','a5');
      const pageWidth=pdf.internal.pageSize.getWidth();
      const pageHeight=pdf.internal.pageSize.getHeight();
      const imgWidth=pageWidth-10;
      const imgHeight=canvas.height * imgWidth / canvas.width;
      const yOffset = (pageHeight - imgHeight)/2;
      pdf.addImage(imgData,'PNG',5, yOffset>0?yOffset:5, imgWidth,imgHeight);
      pdf.save('document.pdf');
    });
  }
  if(currentAction==='word'){
    let htmlContent=doc.innerHTML;
    let blob=new Blob(['<html><body>'+htmlContent+'</body></html>'],{type:'application/msword'});
    let link=document.createElement('a');
    link.href=URL.createObjectURL(blob);
    link.download='document.doc';
    link.click();
  }
}
</script>
</body>
</html>