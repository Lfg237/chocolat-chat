<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mini Secrétariat - Multi-Documents Complet</title>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:linear-gradient(120deg,#ffecd2,#fcb69f,#a1c4fd,#c2e9fb);background-size:600% 600%;animation:gradientBG 15s ease infinite;overflow-x:hidden;}
@keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
header,footer{background:#00796b;color:#fff;padding:10px;text-align:center;position:fixed;width:100%;z-index:10;}
header{top:0} footer{bottom:0}
.nav-buttons{position:fixed;top:56px;left:50%;transform:translateX(-50%);z-index:20;display:flex;gap:8px;padding:6px;border-radius:10px;background:rgba(255,255,255,0.95);}
.nav-buttons button{padding:8px 12px;border-radius:6px;border:none;background:#ff7043;color:#fff;font-weight:700;cursor:pointer;}
.nav-container{display:flex;overflow-x:auto;scroll-behavior:smooth;margin:120px 0 70px 0;padding:12px;}
.doc-card{min-width:360px;background:#fff;border-radius:12px;padding:18px;margin:0 10px;box-shadow:0 6px 18px rgba(0,0,0,0.12);flex-shrink:0;}
.photo{width:80px;height:80px;border-radius:10px;border:2px dashed #00796b;display:flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer;background:#e8f5f2;}
.photo img{width:100%;height:100%;object-fit:cover;}
.field{margin:8px 0;}
label{font-weight:700;color:#004d40;}
input,textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;margin-top:6px;}
canvas{border:1px solid #00796b;border-radius:6px;margin-top:6px;touch-action:none;}
button.action{background:#00796b;color:#fff;padding:10px 16px;border-radius:8px;border:none;cursor:pointer;}
button.ghost{background:#e0e0e0;color:#333;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;margin-left:8px;}
#popupOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:9998;align-items:center;justify-content:center;padding:12px;}
#popup{background:#fff;padding:18px;border-radius:10px;width:420px;max-width:100%;box-shadow:0 8px 30px rgba(0,0,0,0.3);white-space:pre-line;}
#beneficiaryInfo{white-space:pre-line;margin-top:10px;font-weight:700;color:#004d40;}
.accessTimer{margin-top:8px;color:#d32f2f;font-weight:700;}
.small{font-size:12px;color:#666;margin-top:4px;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<header>🖥️ Mini Secrétariat - Multi-Documents Complet</header>

<div class="nav-buttons">
  <button onclick="scrollPrev()">⬅️</button>
  <button onclick="scrollNext()">➡️</button>
  <button onclick="showAll()">📄 Tous</button>
</div>

<div class="nav-container" id="docNav">

<!-- 1️⃣ CV Pro Enrichi -->
<div class="doc-card" data-doc="CV">
  <h3>📄 CV Pro Enrichi</h3>
  <div class="photo" onclick="choosePhoto('CV')"><img id="profilePhotoCV" src="https://via.placeholder.com/80"></div>
  <input id="photoInputCV" type="file" accept="image/*" style="display:none" onchange="updatePhoto('CV',this)">
  <div class="field"><label>Nom</label><input id="nameCV"></div>
  <div class="field"><label>Profession</label><input id="professionCV"></div>
  <div class="field"><label>Email</label><input id="emailCV"></div>
  <div class="field"><label>Compétences</label><textarea id="skillsCV" rows="3"></textarea></div>
  <div class="field"><label>Formations</label><textarea id="educationCV" rows="3"></textarea></div>
  <div class="field"><label>Expériences</label><textarea id="experienceCV" rows="3"></textarea></div>
  <div class="field"><label>Signature</label><canvas id="signatureCV" width="300" height="80"></canvas><br>
  <button class="ghost" onclick="clearSignature('CV')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('CV')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerCV"></div>
</div>

<!-- 2️⃣ Carte de Visite -->
<div class="doc-card" data-doc="Card">
  <h3>💳 Carte de Visite</h3>
  <div class="photo" onclick="choosePhoto('Card')"><img id="profilePhotoCard" src="https://via.placeholder.com/80"></div>
  <input id="photoInputCard" type="file" accept="image/*" style="display:none" onchange="updatePhoto('Card',this)">
  <div class="field"><label>Nom</label><input id="nameCard"></div>
  <div class="field"><label>Profession</label><input id="professionCard"></div>
  <div class="field"><label>Téléphone</label><input id="phoneCard"></div>
  <div class="field"><label>Email</label><input id="emailCard"></div>
  <div class="field"><label>Signature</label><canvas id="signatureCard" width="300" height="50"></canvas><br>
  <button class="ghost" onclick="clearSignature('Card')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('Card')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerCard"></div>
</div>

<!-- 3️⃣ Lettre de Motivation -->
<div class="doc-card" data-doc="LettreMotivation">
  <h3>✉️ Lettre de Motivation</h3>
  <div class="photo" onclick="choosePhoto('LM')"><img id="profilePhotoLM" src="https://via.placeholder.com/80"></div>
  <input id="photoInputLM" type="file" accept="image/*" style="display:none" onchange="updatePhoto('LM',this)">
  <div class="field"><label>Nom</label><input id="nameLM"></div>
  <div class="field"><label>Objet</label><input id="subjectLM"></div>
  <div class="field"><label>Contenu</label><textarea id="contentLM" rows="5"></textarea></div>
  <div class="field"><label>Signature</label><canvas id="signatureLM" width="300" height="80"></canvas><br>
  <button class="ghost" onclick="clearSignature('LM')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('LettreMotivation')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerLM"></div>
</div>

<!-- 4️⃣ Relevé Bancaire -->
<div class="doc-card" data-doc="Releve">
  <h3>📑 Relevé de Compte</h3>
  <div class="photo" onclick="choosePhoto('Releve')"><img id="profilePhotoReleve" src="https://via.placeholder.com/80"></div>
  <input id="photoInputReleve" type="file" accept="image/*" style="display:none" onchange="updatePhoto('Releve',this)">
  <div class="field"><label>Nom</label><input id="nameReleve"></div>
  <div class="field"><label>Numéro Compte</label><input id="accountReleve"></div>
  <div class="field"><label>Solde</label><input id="balanceReleve"></div>
  <div class="field"><label>Signature</label><canvas id="signatureReleve" width="300" height="80"></canvas><br>
  <button class="ghost" onclick="clearSignature('Releve')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('Releve')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerReleve"></div>
</div>

<!-- 5️⃣ Contrat -->
<div class="doc-card" data-doc="Contrat">
  <h3>📃 Contrat</h3>
  <div class="photo" onclick="choosePhoto('Contrat')"><img id="profilePhotoContrat" src="https://via.placeholder.com/80"></div>
  <input id="photoInputContrat" type="file" accept="image/*" style="display:none" onchange="updatePhoto('Contrat',this)">
  <div class="field"><label>Nom</label><input id="nameContrat"></div>
  <div class="field"><label>Objet</label><input id="subjectContrat"></div>
  <div class="field"><label>Contenu</label><textarea id="contentContrat" rows="5"></textarea></div>
  <div class="field"><label>Signature</label><canvas id="signatureContrat" width="300" height="80"></canvas><br>
  <button class="ghost" onclick="clearSignature('Contrat')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('Contrat')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerContrat"></div>
</div>

<!-- 6️⃣ Attestation -->
<div class="doc-card" data-doc="Attestation">
  <h3>📜 Attestation</h3>
  <div class="photo" onclick="choosePhoto('Attestation')"><img id="profilePhotoAttestation" src="https://via.placeholder.com/80"></div>
  <input id="photoInputAttestation" type="file" accept="image/*" style="display:none" onchange="updatePhoto('Attestation',this)">
  <div class="field"><label>Nom</label><input id="nameAttestation"></div>
  <div class="field"><label>Objet</label><input id="subjectAttestation"></div>
  <div class="field"><label>Contenu</label><textarea id="contentAttestation" rows="5"></textarea></div>
  <div class="field"><label>Signature</label><canvas id="signatureAttestation" width="300" height="80"></canvas><br>
  <button class="ghost" onclick="clearSignature('Attestation')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('Attestation')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerAttestation"></div>
</div>

<!-- 7️⃣ Facture -->
<div class="doc-card" data-doc="Facture">
  <h3>🧾 Facture</h3>
  <div class="photo" onclick="choosePhoto('Facture')"><img id="profilePhotoFacture" src="https://via.placeholder.com/80"></div>
  <input id="photoInputFacture" type="file" accept="image/*" style="display:none" onchange="updatePhoto('Facture',this)">
  <div class="field"><label>Nom</label><input id="nameFacture"></div>
  <div class="field"><label>Objet</label><input id="subjectFacture"></div>
  <div class="field"><label>Montant</label><input id="amountFacture"></div>
  <div class="field"><label>Signature</label><canvas id="signatureFacture" width="300" height="80"></canvas><br>
  <button class="ghost" onclick="clearSignature('Facture')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('Facture')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerFacture"></div>
</div>

<!-- 8️⃣ Certificat -->
<div class="doc-card" data-doc="Certificat">
  <h3>🎓 Certificat</h3>
  <div class="photo" onclick="choosePhoto('Certificat')"><img id="profilePhotoCertificat" src="https://via.placeholder.com/80"></div>
  <input id="photoInputCertificat" type="file" accept="image/*" style="display:none" onchange="updatePhoto('Certificat',this)">
  <div class="field"><label>Nom</label><input id="nameCertificat"></div>
  <div class="field"><label>Objet</label><input id="subjectCertificat"></div>
  <div class="field"><label>Contenu</label><textarea id="contentCertificat" rows="5"></textarea></div>
  <div class="field"><label>Signature</label><canvas id="signatureCertificat" width="300" height="80"></canvas><br>
  <button class="ghost" onclick="clearSignature('Certificat')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('Certificat')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerCertificat"></div>
</div>

<!-- 9️⃣ Procès-Verbal -->
<div class="doc-card" data-doc="PV">
  <h3>📝 Procès-Verbal</h3>
  <div class="photo" onclick="choosePhoto('PV')"><img id="profilePhotoPV" src="https://via.placeholder.com/80"></div>
  <input id="photoInputPV" type="file" accept="image/*" style="display:none" onchange="updatePhoto('PV',this)">
  <div class="field"><label>Nom</label><input id="namePV"></div>
  <div class="field"><label>Objet</label><input id="subjectPV"></div>
  <div class="field"><label>Contenu</label><textarea id="contentPV" rows="5"></textarea></div>
  <div class="field"><label>Signature</label><canvas id="signaturePV" width="300" height="80"></canvas><br>
  <button class="ghost" onclick="clearSignature('PV')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('PV')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerPV"></div>
</div>

<!-- 🔟 Note Interne -->
<div class="doc-card" data-doc="Note">
  <h3>🗂️ Note Interne</h3>
  <div class="photo" onclick="choosePhoto('Note')"><img id="profilePhotoNote" src="https://via.placeholder.com/80"></div>
  <input id="photoInputNote" type="file" accept="image/*" style="display:none" onchange="updatePhoto('Note',this)">
  <div class="field"><label>Nom</label><input id="nameNote"></div>
  <div class="field"><label>Objet</label><input id="subjectNote"></div>
  <div class="field"><label>Contenu</label><textarea id="contentNote" rows="5"></textarea></div>
  <div class="field"><label>Signature</label><canvas id="signatureNote" width="300" height="80"></canvas><br>
  <button class="ghost" onclick="clearSignature('Note')">🗑 Effacer</button></div>
  <button class="action" onclick="checkAccessAndDownload('Note')">💳 Télécharger PDF</button>
  <div class="accessTimer" id="timerNote"></div>
</div>

</div>

<!-- POPUP PAIEMENT -->
<div id="popupOverlay">
  <div id="popup">
    💳 Effectuez votre paiement Mobile Money ou utilisez le code d'accès.
    <div id="beneficiaryInfo">Loveline Wirnkar Momo : 676353859\nOM : 640647072</div>
    <input type="text" id="paymentInput" placeholder="Code ou message Mobile Money"/>
    <button onclick="validatePayment()">✅ Valider</button>
    <div class="small">Après paiement/code valide, téléchargement automatique. 100 XAF = 5 min d'accès.</div>
  </div>
</div>

<script>
const BENEFICIARY = { name:"MICHEL KONO EMINI", momo:"676353859", om:"640647072" };
const ADMIN_CODE = "233233";
let timers = {}, downloadCount={}, multiplier=1, accessDurationPer100XAF=5*60, usedTransactions={};

// Navigation
function scrollNext(){document.getElementById("docNav").scrollBy({left:400,behavior:'smooth'});}
function scrollPrev(){document.getElementById("docNav").scrollBy({left:-400,behavior:'smooth'});}
function showAll(){document.getElementById("docNav").scrollTo({left:0,behavior:'smooth'});}

// Gestion Photos
function choosePhoto(doc){document.getElementById('photoInput'+doc).click();}
function updatePhoto(doc,input){
  const file = input.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = e => document.getElementById('profilePhoto'+doc).src = e.target.result;
    reader.readAsDataURL(file);
  }
}

// Signature
let isDrawing=false, currentCanvas=null;
document.querySelectorAll("canvas").forEach(cv=>{
  cv.addEventListener("mousedown",startDraw);
  cv.addEventListener("mousemove",draw);
  cv.addEventListener("mouseup",()=>isDrawing=false);
  cv.addEventListener("mouseleave",()=>isDrawing=false);
  cv.addEventListener("touchstart",startDraw);
  cv.addEventListener("touchmove",draw);
  cv.addEventListener("touchend",()=>isDrawing=false);
});
function startDraw(e){isDrawing=true;currentCanvas=e.target;draw(e);}
function draw(e){
  if(!isDrawing) return;
  const ctx=currentCanvas.getContext("2d");
  const rect=currentCanvas.getBoundingClientRect();
  let x=(e.touches?e.touches[0].clientX:e.clientX)-rect.left;
  let y=(e.touches?e.touches[0].clientY:e.clientY)-rect.top;
  ctx.fillStyle="#000"; ctx.beginPath(); ctx.arc(x,y,1.5,0,Math.PI*2); ctx.fill();
}
function clearSignature(doc){
  const cv=document.getElementById('signature'+doc);
  cv.getContext("2d").clearRect(0,0,cv.width,cv.height);
}

// Popup paiement
let currentDoc=null;
function checkAccessAndDownload(doc){
  const now = Date.now();
  if(timers[doc] && timers[doc] > now){
    downloadPDF(doc);
  } else {
    currentDoc = doc;
    document.getElementById("popupOverlay").style.display="flex";
  }
}
function hidePopup(){document.getElementById("popupOverlay").style.display="none";}

// Validation paiement
function validatePayment(){
  const val = document.getElementById("paymentInput").value.trim();
  if(!val) return alert("Entrez un code ou message Mobile Money");
  
  // Méthode 2 : Code administrateur caché
  if(val === ADMIN_CODE){
    grantAccess(currentDoc,5*60); // 5 min
    hidePopup(); downloadPDF(currentDoc);
    return;
  }

  // Méthode 1 : Message Mobile Money
  if(parseMomoMessage(val)){
    hidePopup(); downloadPDF(currentDoc);
  } else {
    alert("Message invalide ou expiré !");
  }
}

// Parser le message MoMo
function parseMomoMessage(msg){
  try{
    const nameOk = msg.includes(BENEFICIARY.name);
    const phoneOk = msg.includes(BENEFICIARY.momo) || msg.includes(BENEFICIARY.om);
    const idMatch = msg.match(/Id:\s*(\d+)/i);
    const timeMatch = msg.match(/à\s*(\d{4}-\d{2}-\d{2}\s*\d{2}:\d{2}:\d{2})/i);

    if(!nameOk || !phoneOk || !idMatch || !timeMatch) return false;
    const transId = idMatch[1];
    if(usedTransactions[transId]) return false; // doublon

    const t = new Date(timeMatch[1]).getTime();
    if(Date.now()-t > 10*60*1000) return false; // >10min

    usedTransactions[transId]=true;

    // Montant & durée
    const m = msg.match(/rec[u|v] (\d+)/i);
    let amount = m? parseInt(m[1]):100;
    let minutes = Math.floor(amount/100)*accessDurationPer100XAF/60;

    grantAccess(currentDoc, minutes*60);
    return true;
  }catch(e){return false;}
}

// Accorder accès
function grantAccess(doc,duration){
  const now = Date.now();
  if(timers[doc] && timers[doc] > now){
    timers[doc] += duration*1000;
    multiplier++;
  } else {
    timers[doc] = now + duration*1000;
    multiplier=1;
  }
  startTimer(doc);
}

// Timer visuel
function startTimer(doc){
  const el = document.getElementById("timer"+doc);
  function update(){
    const left = timers[doc]-Date.now();
    if(left>0){
      el.textContent = "⏳ Temps restant: "+Math.ceil(left/1000)+"s (x"+multiplier+")";
      requestAnimationFrame(update);
    } else {
      el.textContent="⛔ Temps expiré";
    }
  }
  update();
}

// Génération PDF (exemple simplifié)
function downloadPDF(doc){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.text("Document : "+doc,20,20);
  pdf.text("Contenu généré automatiquement.",20,40);
  pdf.save(doc+".pdf");
}
</script>

<footer>© 2025 Mini Secrétariat</footer>
</body>
</html>