<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tableau Utilisateurs</title>
<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
<style>
body{font-family:Arial,sans-serif;background:#f0f8ff;margin:0;padding:0;}
.page{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:20px;overflow-y:auto;border-bottom:2px solid #ccc;}
.handwriting{font-family:'Patrick Hand', cursive;font-weight:bold;font-size:28px;margin:10px 0;} /* titres */
.paper{background:white;padding:20px;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.1);max-width:600px;width:100%;display:inline-block;} 
.category{font-weight:bold;margin:4px 0;font-size:16px;} 
button{padding:10px 16px;border:none;border-radius:5px;background:#25D366;color:white;font-weight:bold;cursor:pointer;margin-top:10px;}

/* Popup paiement */
.popup-bg{
  position: fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);
  display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;transition:0.3s;
  z-index:999;
}
.popup{
  background:white;padding:20px;border-radius:8px;max-width:320px;text-align:center;box-shadow:0 0 15px rgba(0,0,0,0.3);
}
.popup button{margin:5px;}
.popup-bg.show{visibility:visible;opacity:1;}
</style>
</head>
<body>

<div id="sections"></div>

<!-- Popup paiement -->
<div class="popup-bg" id="paymentPopup">
  <div class="popup">
    <p>üí∞ Paiement requis pour t√©l√©charger le PDF</p>
    <button id="payConfirm">‚úÖ Payer</button>
    <button id="payCancel">‚ùå Annuler</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const { jsPDF } = window.jspdf;

// Exemple utilisateurs
const users=[
  {
    nom:"Alice Dupont",
    profession:"D√©veloppeuse",
    cv:{prenom:"Alice", age:"28", ville:"Paris", poste:"Frontend", email:"alice@example.com"},
    lettre:{prenom:"Alice", nom:"Dupont", entreprise:"TechCorp", poste:"Ing√©nieur", contenu:"Motivation pour rejoindre TechCorp."},
    plan:{plan:"123 Rue de Paris"}
  },
  {
    nom:"Bob Martin",
    profession:"Designer",
    cv:{prenom:"Bob", age:"30", ville:"Lyon", poste:"Graphiste", email:"bob@example.com"},
    lettre:{prenom:"Bob", nom:"Martin", entreprise:"DesignInc", poste:"Graphiste", contenu:"Motivation pour DesignInc."},
    plan:{plan:"456 Avenue Lyon"}
  }
];

// Fonction PDF
function downloadPDFFromElement(element, filename){
  html2canvas(element,{scale:2,useCORS:true}).then(canvas=>{
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p','mm','a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
    pdf.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);
    pdf.save(filename);
  });
}

// G√©n√©ration des pages
const container=document.getElementById('sections');
users.forEach((user,index)=>{
  ["CV","LETTRE DE MOTIVATION","PLAN DE LOCALISATION"].forEach((section,i)=>{
    const page=document.createElement('div');
    page.className='page';
    let contentHTML = '';
    let btnLabel = '';
    let divID = '';
    if(section==="CV"){
      divID = `cv${index}`;
      contentHTML = `
        <div class="paper" id="${divID}">
          <p class="category">Pr√©nom: ${user.cv.prenom}</p>
          <p class="category">√Çge: ${user.cv.age}</p>
          <p class="category">Ville: ${user.cv.ville}</p>
          <p class="category">Dernier poste: ${user.cv.poste}</p>
          <p class="category">Email: ${user.cv.email}</p>
        </div>`;
      btnLabel = `üì• T√©l√©charger CV PDF`;
    }
    if(section==="LETTRE DE MOTIVATION"){
      divID = `lettre${index}`;
      contentHTML = `
        <div class="paper" id="${divID}">
          <p class="category">Pr√©nom: ${user.lettre.prenom}</p>
          <p class="category">Nom: ${user.lettre.nom}</p>
          <p class="category">Entreprise: ${user.lettre.entreprise}</p>
          <p class="category">Poste: ${user.lettre.poste}</p>
          <p class="category">Contenu: ${user.lettre.contenu}</p>
        </div>`;
      btnLabel = `üì• T√©l√©charger Lettre PDF`;
    }
    if(section==="PLAN DE LOCALISATION"){
      divID = `plan${index}`;
      contentHTML = `
        <div class="paper" id="${divID}">
          <p class="category">Plan: ${user.plan.plan}</p>
        </div>`;
      btnLabel = `üì• T√©l√©charger Plan PDF`;
    }
    page.innerHTML = `<h1 class="handwriting">${section} - ${user.nom}</h1>
                      ${contentHTML}
                      <button class="btnPDF" data-target="${divID}" data-filename="${section}_${user.nom}.pdf">${btnLabel}</button>
                      <button class="btnWA" data-index="${index}">üì§ Partager sur WhatsApp</button>`;
    container.appendChild(page);
  });
});

// Gestion popup paiement
let currentElement = null;
let currentFilename = null;
const popup = document.getElementById('paymentPopup');
const payConfirm = document.getElementById('payConfirm');
const payCancel = document.getElementById('payCancel');

document.querySelectorAll('.btnPDF').forEach(btn=>{
  btn.onclick = ()=>{
    currentElement = document.getElementById(btn.dataset.target);
    currentFilename = btn.dataset.filename;
    popup.classList.add('show');
  }
});

// Paiement valid√© ‚Üí t√©l√©chargement automatique du PDF
payConfirm.onclick = ()=>{
  if(currentElement && currentFilename){
    // Ici, tu peux int√©grer la logique de paiement r√©elle
    downloadPDFFromElement(currentElement, currentFilename);
  }
  popup.classList.remove('show');
};
payCancel.onclick = ()=>{ popup.classList.remove('show'); };

// WhatsApp
function generateWhatsAppText(user){
  let text = "‚úèÔ∏èüñãÔ∏è *üìÑ CV DE " + user.nom.toUpperCase() + "*\n";
  text += "üë§ *Pr√©nom:* " + user.cv.prenom + "\n";
  text += "üéÇ *√Çge:* " + user.cv.age + "\n";
  text += "üèôÔ∏è *Ville:* " + user.cv.ville + "\n";
  text += "üíº *Dernier poste:* " + user.cv.poste + "\n";
  text += "üìß *Email:* " + user.cv.email + "\n\n";

  text += "‚úèÔ∏èüñãÔ∏è *‚úâÔ∏è LETTRE DE MOTIVATION*\n";
  text += "üë§ *Pr√©nom:* " + user.lettre.prenom + "\n";
  text += "üë§ *Nom:* " + user.lettre.nom + "\n";
  text += "üè¢ *Entreprise:* " + user.lettre.entreprise + "\n";
  text += "üíº *Poste:* " + user.lettre.poste + "\n";
  text += "üìù *Contenu:* " + user.lettre.contenu + "\n\n";

  text += "‚úèÔ∏èüñãÔ∏è *üó∫Ô∏è PLAN DE LOCALISATION*\n";
  text += "üìç *Plan:* " + user.plan.plan + "\n";
  return text;
}

document.querySelectorAll('.btnWA').forEach(btn=>{
  btn.onclick = ()=>{
    const user = users[parseInt(btn.dataset.index)];
    const text = generateWhatsAppText(user);
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
  }
});
</script>
</body>
</html>