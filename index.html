<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CV / Lettre / Plan complet</title>
<style>
body{font-family:Arial,sans-serif;background:#e0f7fa;margin:0;padding:10px;}
.paper{background:white;padding:20px;margin:0 auto;max-width:900px;box-shadow:0 0 15px rgba(0,0,0,0.2);border-radius:5px;}
header{text-align:center;margin-bottom:20px;}
header h1{font-size:2em;font-weight:bold;margin:0;}
header h2{font-size:1em;color:#555;margin:5px 0;}
section{margin-bottom:20px;padding:15px;border:1px solid #ccc;border-radius:5px;page-break-inside:avoid;}
section h3{margin-top:0;color:#1e88e5;}
input,textarea{width:100%;padding:6px;margin:5px 0;border:1px solid #1e88e5;border-radius:4px;}
button{padding:10px;margin:5px 0;border:none;border-radius:5px;background:#25D366;color:white;font-weight:bold;cursor:pointer;}
.page-break{page-break-after:always;}
#popupOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;}
#popup{background:#fff;padding:15px;border-radius:10px;width:90%;max-width:400px;}
.result{margin:5px 0;font-weight:bold;}
#photoPreview{display:none;width:120px;height:120px;border-radius:10px;margin-top:10px;}
.text-output p{margin:2px 0;}
</style>
</head>
<body>

<h1>📄 CV / Lettre / Plan complet</h1>

<div class="paper" id="paperContent">

<header>
<h1 id="displayName">Nom Complet</h1>
<h2 id="displayProfession">Profession</h2>
</header>

<section id="photoSection">
<h3>📸 Photo (facultatif)</h3>
<input type="file" id="photoInput" accept="image/*">
<img id="photoPreview">
</section>

<section id="cv">
<h3>👤 CV</h3>
<input id="fullName" placeholder="Nom complet">
<input id="profession" placeholder="Profession / poste">
<input id="prenom" placeholder="Prénom">
<input id="age" placeholder="Âge">
<input id="ville" placeholder="Ville">
<input id="quartier" placeholder="Quartier">
<input id="situation" placeholder="Situation matrimoniale">
<input id="enfants" placeholder="Nombre d'enfants">
<input id="poste" placeholder="Dernier poste">
<input id="loisirs" placeholder="Loisirs">
<input id="caractere" placeholder="Caractère">
<input id="diplome" placeholder="Dernier diplôme">
<input id="etablissement" placeholder="Établissement">
<input id="alcool" placeholder="Alcoolique Oui/Non">
<input id="salaire" placeholder="Salaire">
<input id="email" placeholder="Email">
<input id="telMtn" placeholder="Tel MTN">
<input id="telOrange" placeholder="Tel Orange">
</section>

<div class="page-break"></div>

<section id="lettre">
<h3>✉️ Lettre de motivation</h3>
<input id="prenomLetter" placeholder="Prénom">
<input id="nomLetter" placeholder="Nom">
<input id="entreprise" placeholder="Entreprise">
<input id="posteLetter" placeholder="Poste souhaité">
<textarea id="contenu" placeholder="Contenu"></textarea>
</section>

<div class="page-break"></div>

<section id="plan">
<h3>🗺️ Plan de localisation</h3>
<textarea id="planText" placeholder="Plan de localisation"></textarea>
</section>
</div>

<button id="shareBtn">📤 Partager sur WhatsApp</button>
<button id="downloadPdf">📥 Télécharger PDF</button>

<!-- Popup paiement -->
<div id="popupOverlay">
<div id="popup">
<h2>Paiement requis</h2>
<p>Bénéficiaire: Wirnkar Loveline</p>
<p>MTN MoMo: 676353859<br>OM: 640647072<br>Montant: 25 FCFA</p>
<textarea class="momoMsg" placeholder="Message Mobile Money"></textarea>
<input class="adminCode" type="password" placeholder="Code admin">
<div class="result"></div>
<button class="validateAdminBtn">✅ Valider code admin</button>
<button class="verifyBtn">✅ Vérifier & Partager</button>
<button onclick="document.getElementById('popupOverlay').style.display='none'">Annuler</button>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
const EXPECTED={phones:['676353859','640647072'],amount:25,admin:'233233'};
let isAdmin=false;

// Nom et profession dynamiques
const fullNameInput=document.getElementById('fullName');
const professionInput=document.getElementById('profession');
fullNameInput.addEventListener('input',()=>document.getElementById('displayName').textContent=fullNameInput.value || "Nom Complet");
professionInput.addEventListener('input',()=>document.getElementById('displayProfession').textContent=professionInput.value || "Profession");

// Photo preview
const photoInput=document.getElementById('photoInput');
const photoPreview=document.getElementById('photoPreview');
photoInput.addEventListener('change', e=>{
  const file=e.target.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=function(ev){photoPreview.src=ev.target.result; photoPreview.style.display='block';}
    reader.readAsDataURL(file);
  }
});

// WhatsApp
function getAllText(){
  let text=`📄 CV de ${fullNameInput.value} (${professionInput.value})\n\n`;
  document.querySelectorAll('#cv input').forEach(i=>text+=`${i.placeholder}: ${i.value}\n`);
  document.querySelectorAll('#lettre input, #lettre textarea').forEach(i=>text+=`${i.placeholder}: ${i.value}\n`);
  text+=`Plan: ${document.getElementById('planText').value}\n`;
  return text;
}
document.getElementById('shareBtn').onclick=()=>{
  if(isAdmin){window.open(`https://wa.me/?text=${encodeURIComponent(getAllText())}`,'_blank');}
  else document.getElementById('popupOverlay').style.display='flex';
};

// PDF multi-pages avec conversion inputs -> texte
document.getElementById('downloadPdf').onclick=()=>{
  const tempDiv=document.createElement('div');
  tempDiv.style.position='absolute';
  tempDiv.style.left='-9999px';
  
  const clone=document.getElementById('paperContent').cloneNode(true);
  clone.classList.add('text-output');
  
  clone.querySelectorAll('input,textarea').forEach(i=>{
    const p=document.createElement('p');
    p.textContent=`${i.placeholder}: ${i.value}`;
    i.parentNode.replaceChild(p,i);
  });
  
  tempDiv.appendChild(clone);
  document.body.appendChild(tempDiv);
  
  html2pdf().from(tempDiv).set({
    margin:10,
    filename:'document_complet.pdf',
    html2canvas:{scale:2,useCORS:true},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
  }).save().finally(()=>document.body.removeChild(tempDiv));
};

// Popup paiement
const popup=document.getElementById('popupOverlay');
const momoMsg=popup.querySelector('.momoMsg');
const adminInput=popup.querySelector('.adminCode');
const validateBtn=popup.querySelector('.validateAdminBtn');
const verifyBtn=popup.querySelector('.verifyBtn');
const result=popup.querySelector('.result');

validateBtn.onclick=()=>{
  if(adminInput.value===EXPECTED.admin){isAdmin=true; result.innerHTML='<span style="color:green">Code admin correct ✅</span>'; popup.style.display='none';}
  else result.innerHTML='<span style="color:red">Code admin incorrect ❌</span>';
};

verifyBtn.onclick=()=>{
  const msg=momoMsg.value.toLowerCase().replace(/\s+/g,''); result.innerHTML='';
  if(!EXPECTED.phones.some(p=>msg.includes(p))){ result.innerHTML='<span style="color:red">Numéro incorrect</span>'; return; }
  const amt=msg.match(/(\d+)/); if(!amt || parseInt(amt[0])!==EXPECTED.amount){ result.innerHTML='<span style="color:red">Montant incorrect</span>'; return; }
  result.innerHTML='<span style="color:green">✅ Vérifié ! PDF prêt au téléchargement</span>';
  popup.style.display='none';
};
</script>
</body>
</html>