<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Documents A6 PWA</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00695c">
<style>
body{font-family:"Segoe UI",Arial,sans-serif;background:#e0f7fa;margin:0;padding:12px;}
h1{text-align:center;color:#00695c;margin:6px 0 16px;font-size:24px;}
section{background:#fff;border-radius:10px;padding:12px;margin:10px auto;max-width:780px;box-shadow:0 6px 18px rgba(0,0,0,0.08);}
h2{margin:0 0 12px;font-size:18px;color:#333;text-align:center;}
.photo{width:120px;height:120px;border-radius:8px;border:2px dashed #ff6f00;background-position:center;background-size:cover;cursor:pointer;}
.signature{border-radius:6px;border:1px solid #43a047;margin-top:8px;display:block;}
.actions{display:flex;gap:8px;margin-top:8px;}
.btn{background:#00c853;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;}
.btn.secondary{background:#2196f3;}
.back-btn{margin:8px;padding:6px 10px;background:#ff5722;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;}
.text-area{resize:none;width:100%;padding:10px;font-size:14px;border:none;border-radius:6px;box-sizing:border-box;overflow:auto;}
.section-flex{display:flex; gap:12px;}
.section-right{flex:1; display:flex; flex-direction:column;}
</style>
</head>
<body>
<h1>üìÑ Mes Documents A6 PWA</h1>
<button class="back-btn" onclick="window.history.back()">‚¨Ö Retour</button>

<!-- CV -->
<section id="cvDoc">
<h2>Curriculum Vitae</h2>
<div class="section-flex">
  <div>
    <img id="cvPhoto" class="photo" src="">
    <input type="file" id="cvPhotoInput" accept="image/*" style="display:none">
    <canvas id="cvSign" class="signature" style="width:120px;height:100px;"></canvas>
  </div>
  <div class="section-right">
    <div contenteditable="true" id="cvNomPrenom" style="font-weight:700;font-size:22px;">Nom Pr√©nom</div>
    <div contenteditable="true" id="cvFonctionAge" style="font-size:14px;margin-top:4px;">Fonction - √Çge</div>
    <div id="cvInfos" style="margin-top:12px;flex:1;">
      <div contenteditable="true">Situation matrimoniale: </div>
      <div contenteditable="true">Nombre d'enfants: </div>
      <div contenteditable="true">R√©gion: </div>
      <div contenteditable="true">Nationalit√©: </div>
      <div contenteditable="true">Ville de r√©sidence: </div>
      <div contenteditable="true">Quartier: </div>
      <div contenteditable="true">Alcoolique (oui/non): </div>
      <div contenteditable="true">Religion: </div>
      <div contenteditable="true">Autres exp√©riences: </div>
      <div contenteditable="true">Dernier dipl√¥me: </div>
      <div contenteditable="true">Dernier √©tablissement: </div>
      <div contenteditable="true">Dernier poste occup√©: </div>
      <div contenteditable="true">Dernier salaire: </div>
    </div>
    <div class="actions">
      <button class="btn" data-doc="cvDoc" data-act="pdf">PDF</button>
      <button class="btn" data-doc="cvDoc" data-act="word">Word</button>
    </div>
  </div>
</div>
</section>

<!-- Lettre de Motivation -->
<section id="lettreDoc">
<h2>Lettre de Motivation</h2>
<div class="section-flex">
  <div>
    <img id="lettrePhoto" class="photo" src="">
    <input type="file" id="lettrePhotoInput" accept="image/*" style="display:none">
    <canvas id="lettreSign" class="signature" style="width:120px;height:60px;"></canvas>
  </div>
  <div class="section-right">
    <div id="lettreTexte" contenteditable="true" class="text-area" style="flex:1;" data-placeholder="Cliquez ici pour taper votre lettre‚Ä¶">
      Cliquez ici pour taper votre lettre‚Ä¶
    </div>
    <div class="actions">
      <button class="btn" data-doc="lettreDoc" data-act="pdf">PDF</button>
      <button class="btn" data-doc="lettreDoc" data-act="word">Word</button>
    </div>
  </div>
</div>
</section>

<!-- Plan de Localisation -->
<section id="planDoc">
<h2>Plan de Localisation</h2>
<div class="section-flex">
  <div>
    <img id="planPhoto" class="photo" src="">
    <input type="file" id="planPhotoInput" accept="image/*" style="display:none">
    <canvas id="planSign" class="signature" style="width:120px;height:60px;"></canvas>
  </div>
  <div class="section-right">
    <div id="planTexte" contenteditable="true" class="text-area" style="flex:1;" data-placeholder="Cliquez ici pour d√©crire le plan‚Ä¶">
      Cliquez ici pour d√©crire le plan‚Ä¶
    </div>
    <div class="actions">
      <button class="btn" data-doc="planDoc" data-act="pdf">PDF</button>
      <button class="btn" data-doc="planDoc" data-act="word">Word</button>
    </div>
  </div>
</div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
window.onload = ()=>{
  // --- Photos ---
  function handlePhoto(imgId,inputId){
    const img=document.getElementById(imgId);
    const input=document.getElementById(inputId);
    img.addEventListener('click',()=>input.click());
    input.addEventListener('change',e=>{
      const file=e.target.files[0]; if(!file) return;
      const reader=new FileReader();
      reader.onload=ev=>{img.src=ev.target.result;};
      reader.readAsDataURL(file);
    });
  }
  handlePhoto('cvPhoto','cvPhotoInput');
  handlePhoto('lettrePhoto','lettrePhotoInput');
  handlePhoto('planPhoto','planPhotoInput');

  // --- Signatures ---
  function makeSign(id){
    const c=document.getElementById(id);
    c.width=c.clientWidth*devicePixelRatio;
    c.height=c.clientHeight*devicePixelRatio;
    const ctx=c.getContext('2d'); ctx.scale(devicePixelRatio,devicePixelRatio);
    ctx.lineJoin='round'; ctx.lineCap='round'; ctx.strokeStyle='#222'; ctx.lineWidth=2;
    let drawing=false;
    function pos(e){const r=c.getBoundingClientRect();return e.touches?[{x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top}][0]:{x:e.clientX-r.left,y:e.clientY-r.top};}
    function start(e){drawing=true; const p=pos(e); ctx.beginPath(); ctx.moveTo(p.x,p.y);}
    function move(e){if(!drawing) return; const p=pos(e); ctx.lineTo(p.x,p.y); ctx.stroke();}
    function end(){drawing=false; ctx.closePath();}
    c.addEventListener('mousedown',start); c.addEventListener('mousemove',move);
    c.addEventListener('mouseup',end); c.addEventListener('mouseleave',end);
    c.addEventListener('touchstart',start,{passive:false}); c.addEventListener('touchmove',move,{passive:false}); c.addEventListener('touchend',end);
  }
  makeSign('cvSign'); makeSign('lettreSign'); makeSign('planSign');

  // --- Placeholder ---
  ['lettreTexte','planTexte'].forEach(id=>{
    const el=document.getElementById(id);
    const placeholder=el.getAttribute('data-placeholder');
    el.addEventListener('focus',()=>{if(el.innerText===placeholder) el.innerText='';});
    el.addEventListener('blur',()=>{if(el.innerText.trim()==='') el.innerText=placeholder;});
  });

  // --- PDF / Word export ---
  document.querySelectorAll('.btn[data-doc]').forEach(btn=>{
    btn.addEventListener('click',async ()=>{
      const docId=btn.getAttribute('data-doc');
      const act=btn.getAttribute('data-act');
      const node=document.getElementById(docId);
      const canvas=await html2canvas(node,{scale:2,useCORS:true,allowTaint:true});
      const imgData=canvas.toDataURL('image/png');
      const {jsPDF}=window.jspdf;
      const pdf=new jsPDF('p','mm','a6');
      const w=pdf.internal.pageSize.getWidth(), h=pdf.internal.pageSize.getHeight();
      let imgW=w, imgH=(canvas.height*imgW)/canvas.width;
      if(imgH>h){ const r=h/imgH; imgH*=r; imgW*=r; }
      pdf.addImage(imgData,'PNG',0,0,imgW,imgH);
      if(act==='pdf'){ pdf.save(docId+'.pdf'); return; }
      const blob=new Blob(['<html><body>'+node.innerHTML+'</body></html>'],{type:'application/msword'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=docId+'.doc'; a.click();
    });
  });
};
</script>
</body>
</html>