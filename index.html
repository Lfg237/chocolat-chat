<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mini Secrétariat Complet - LesFacilitateurs</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<style>
:root{--bg1:#ffefd5;--bg2:#ffe4f0;--accent:#ff6b6b;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:Inter,sans-serif;background:linear-gradient(120deg,var(--bg1),var(--bg2));color:#222;overflow:hidden;}
.header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:rgba(255,255,255,0.6);backdrop-filter:blur(6px);box-shadow:0 6px 18px rgba(0,0,0,0.06);position:sticky;top:0;z-index:10;}
.brand{display:flex;align-items:center;gap:12px;}
.brand .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(45deg,#ff9a9e,#fad0c4);display:flex;align-items:center;justify-content:center;font-size:28px;}
.brand h1{font-family:Dancing Script,cursive;margin:0;font-size:20px;color:var(--accent);}
.navbar{overflow-x:auto;white-space:nowrap;padding:10px;background:rgba(255,255,255,0.6);backdrop-filter:blur(6px);}
.navbar button{display:inline-block;margin-right:8px;padding:10px 14px;border-radius:999px;border:0;background:linear-gradient(90deg,#fff,rgba(255,255,255,0.6));box-shadow:0 4px 8px rgba(0,0,0,0.06);cursor:pointer;font-size:11px;}
.container{padding:8px;display:flex;justify-content:center;}
.main{background:rgba(255,255,255,0.9);padding:8mm;border-radius:12px;width:95%;max-width:400px;min-height:105mm;overflow-y:auto;-webkit-overflow-scrolling:touch;position:relative;font-size:11px;line-height:1.4;word-wrap: break-word;}
.doc-title{font-family:Dancing Script,cursive;font-size:18px;margin:6px 0;}
.handwritten{font-family:'Dancing Script',cursive;font-weight:700;font-size:16px;color:#2c3e50;}
.doc-photo{width:80px;height:80px;object-fit:cover;border-radius:10px;border:2px solid white;box-shadow:0 4px 12px rgba(0,0,0,0.08);cursor:pointer;float:left;margin-right:8px;margin-bottom:8px;}
.field{margin-bottom:6px;}
.field label{display:block;font-size:11px;color:#555;margin-bottom:4px;font-weight:600;}
.field textarea{width:100%;min-height:100px;max-height:200px;padding:5px;border:1px solid #eee;border-radius:6px;font-size:11px;line-height:1.3;resize:vertical;overflow-y:auto;}
.signature-area{border:2px dashed #000;border-radius:8px;display:block;margin-bottom:6px;width:100%;height:60px;touch-action:none;}
.btn{padding:6px 10px;border-radius:8px;border:0;cursor:pointer;margin-top:4px;font-size:11px;}
.btn-primary{background:linear-gradient(90deg,#4facfe,#00f2fe);color:white;}
.btn-ghost{background:transparent;border:1px solid #ddd;margin-left:6px;font-size:11px;}
#paymentModal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:1000;}
#paymentModal > div{background:white;border-radius:12px;padding:18px;max-width:400px;width:100%;}
#pmMsg{margin-top:8px;color:crimson;}
</style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="logo">LF</div>
    <h1>Mini Secrétariat — LesFacilitateurs</h1>
  </div>
  <div class="small">✨ Moderne • Coloré • Export Word</div>
</header>

<nav class="navbar" id="mainNav"></nav>

<div class="container">
  <main class="main" id="app">
    <p>Bienvenue dans le Mini Secrétariat. Choisissez un document pour commencer ✨</p>
  </main>
</div>

<div id="paymentModal">
  <div>
    <h3>Paiement requis avant téléchargement</h3>
    <div style="display:flex; flex-direction:column; gap:6px;">
      <h4>Mobile Money / OM</h4>
      <input id="mmBen1" type="text" value="loveline wirnkar momo: 676353859" readonly style="font-weight:600; font-size:14px;"/>
      <input id="mmBen2" type="text" value="OM 640647072" readonly style="margin-top:4px;font-weight:600; font-size:14px;"/>
      <label>Message de transaction</label>
      <input id="mmMsg" type="text" placeholder="Ex: Vous avez recu ..." style="font-size:13px;"/>
    </div>
    <div style="margin-top:8px">
      <h4>Accès VIP</h4>
      <input id="vipInput" type="text" placeholder="Entrez votre code VIP" style="font-size:13px;"/>
    </div>
    <button class="btn btn-primary" style="width:100%;margin-top:8px" onclick="verifierPaiement()">Valider paiement / VIP</button>
    <button class="btn btn-ghost" onclick="fermerPopup()">Annuler</button>
    <p id="pmMsg"></p>
  </div>
</div>

<script>
const documents=['CV','LettreMotivation','CNI','Photocopie','CarteVisite','Plan','Fiche','Contrat','Devis','Facture','Galerie'];
const nav=document.getElementById('mainNav');
let pendingDoc=null;
let paiementValide=false;
const VIP_CODE='233233'; // code caché

// Création des boutons
documents.forEach(doc=>{
  const btn=document.createElement('button');
  btn.textContent=doc.replace(/([A-Z])/g," $1").trim();
  btn.onclick=()=>ouvrirDoc(doc);
  nav.appendChild(btn);
});

function ouvrirDoc(doc){
  pendingDoc=doc;
  const app=document.getElementById('app');

  const photoHTML=(id,title)=>`
    <input type="file" id="${id}" accept="image/*" style="display:none" onchange="afficherPhoto('${id}','img${id}')"/>
    <label for="${id}"><img id="img${id}" class="doc-photo" title="${title}"/></label>`;

  const sigHTML=`<canvas id="sigCanvas" class="signature-area"></canvas>`;

  let content='';
  switch(doc){
    case 'CNI': case 'Photocopie':
      content=`<div style="display:flex; gap:8px; margin-bottom:8px;">
                 ${photoHTML(doc+'Recto','Photo Recto')}
                 <div style="flex:1;"><div class="field"><label>Texte Recto</label><textarea>Votre texte pour le recto...</textarea></div></div>
               </div>
               <div style="display:flex; gap:8px; margin-bottom:8px;">
                 ${photoHTML(doc+'Verso','Photo Verso')}
                 <div style="flex:1;"><div class="field"><label>Texte Verso</label><textarea>Votre texte pour le verso...</textarea></div></div>
               </div>`; break;
    case 'Galerie':
      content=`<div id="galleryContainer"></div><button class="btn btn-ghost" onclick="ajouterPhotoGalerie()">➕ Ajouter photo</button>`; break;
    default:
      content=`<div style="display:flex; gap:8px; margin-bottom:8px;">
                 ${photoHTML(doc+'Photo','Photo '+doc)}
                 <div style="flex:1;"><div class="field"><label>Texte</label><textarea>Votre contenu ici...</textarea></div></div>
               </div>`;
  }

  app.innerHTML=`<h2 class="doc-title handwritten">${doc.replace(/([A-Z])/g," $1").trim()}</h2>`+
                content+sigHTML+`<button class="btn btn-primary" onclick="demandeTelechargement()">Télécharger Word</button>`;

  initSignature();
  // Textareas flexibles
  document.querySelectorAll('textarea').forEach(t=>{
    t.addEventListener('input',()=>{ t.style.height='auto'; t.style.height=t.scrollHeight+'px'; });
  });
}

// Afficher photo
function afficherPhoto(inputId,imgId){
  const input=document.getElementById(inputId);
  const img=document.getElementById(imgId);
  if(input.files && input.files[0]){
    const reader=new FileReader();
    reader.onload=e=>{document.getElementById(imgId).src=e.target.result;};
    reader.readAsDataURL(input.files[0]);
  }
}

// Galerie
function ajouterPhotoGalerie(){
  const container=document.getElementById('galleryContainer');
  const index=container.children.length+1;
  const id='galleryPhoto'+index;
  const html=`<div style="display:flex; gap:8px; margin-bottom:8px;">
                <input type="file" id="${id}" accept="image/*" style="display:none" onchange="afficherPhoto('${id}','img${id}')"/>
                <label for="${id}"><img id="img${id}" class="doc-photo" title="Photo ${index}"/></label>
                <div style="flex:1;"><div class="field"><label>Commentaire</label><textarea>Votre commentaire...</textarea></div></div>
              </div>`;
  container.insertAdjacentHTML('beforeend',html);
}

// Signature
function initSignature(){
  const c=document.getElementById('sigCanvas');
  const ctx=c.getContext('2d'); ctx.strokeStyle='#000'; ctx.lineWidth=2;
  let drawing=false;
  function getPos(e){const rect=c.getBoundingClientRect(); return {x:(e.touches?e.touches[0].clientX:e.clientX)-rect.left, y:(e.touches?e.touches[0].clientY:e.clientY)-rect.top};}
  function start(e){drawing=true; ctx.beginPath(); const pos=getPos(e); ctx.moveTo(pos.x,pos.y);}
  function draw(e){if(!drawing) return; const pos=getPos(e); ctx.lineTo(pos.x,pos.y); ctx.stroke();}
  function stop(){drawing=false;}
  ['mousedown','touchstart'].forEach(ev=>c.addEventListener(ev,start));
  ['mousemove','touchmove'].forEach(ev=>c.addEventListener(ev,draw));
  ['mouseup','mouseleave','touchend'].forEach(ev=>c.addEventListener(ev,stop));
}

// Popup
function ouvrirPopup(){ document.getElementById('paymentModal').style.display='flex'; }
function fermerPopup(){ document.getElementById('paymentModal').style.display='none'; }

// Vérifier paiement / code VIP
function verifierPaiement(){
  const msg=document.getElementById('mmMsg').value.trim();
  const vip=document.getElementById('vipInput').value.trim();
  const pmMsg=document.getElementById('pmMsg');
  if(vip===VIP_CODE || msg.length>0){
    pmMsg.innerText='Paiement / VIP validé !';
    paiementValide=true;
    fermerPopup();
    telechargerWord();
  }else{
    pmMsg.innerText='Code VIP ou message de transaction requis.';
  }
}

// Téléchargement Word
function demandeTelechargement(){
  if(paiementValide){
    telechargerWord();
  }else{
    ouvrirPopup();
  }
}

function telechargerWord(){
  if(!pendingDoc) return;
  const app=document.getElementById('app').cloneNode(true);
  // remplacer textarea par div
  app.querySelectorAll('textarea').forEach(t=>{
    const div=document.createElement('div');
    div.innerText=t.value;
    t.parentNode.replaceChild(div,t);
  });
  // images flottantes
  app.querySelectorAll('img.doc-photo').forEach(img=>{
    img.style.cssText='max-width:100%; display:block; float:left; margin:0 6px 6px 0;';
  });
  // signature incluse
  const canvas=document.getElementById('sigCanvas');
  if(canvas){
    const imgSig=document.createElement('img');
    imgSig.src=canvas.toDataURL();
    imgSig.style.width='100px';
    imgSig.style.height='50px';
    app.appendChild(imgSig);
  }

  const htmlContent='<html><head><meta charset="utf-8"></head><body>'+app.innerHTML+'</body></html>';
  const link=document.createElement('a');
  link.href='data:application/vnd.ms-word;charset=utf-8,'+encodeURIComponent(htmlContent);
  link.download=pendingDoc+'.doc';
  link.click();
}
</script>
</body>
</html>