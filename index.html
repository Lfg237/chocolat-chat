<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CV / Lettre / Plan</title>
<style>
body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #f0f4f8;
    margin: 0;
    padding: 10px;
}
h1 {
    text-align: center;
    color: #00695c;
    font-size: 28px;
    margin-bottom: 20px;
}
section {
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    background: #fff;
}
h2 { color: #424242; font-size: 22px; margin-bottom: 10px; }
input, textarea {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border: 2px solid #1e88e5;
    border-radius: 8px;
    font-size: 14px;
}
button.primary {
    background: linear-gradient(45deg,#00c853,#b2ff59);
    color: #fff;
    font-weight: bold;
    border: none;
    padding: 10px;
    border-radius: 8px;
    margin-top: 5px;
    cursor: pointer;
}
.cv-photo-preview {
    width: 150px;
    height: 150px;
    border: 3px dashed #ff6f00;
    border-radius: 50%;
    margin: 0 auto 10px auto;
    background-size: cover;
    background-position: center;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ff6f00;
    font-size: 13px;
    font-weight: bold;
}
canvas.signature-canvas {
    border: 2px solid #43a047;
    border-radius: 5px;
    width: 100%;
    height: 120px;
    margin-top: 5px;
}
.flex-row { display:flex; justify-content:space-between; align-items:center; gap:5px; }
#popupOverlay {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.6);
    justify-content:center;
    align-items:center;
    z-index:9999;
}
#popup {
    border:3px solid #1e88e5;
    background:#fffde7;
    padding:15px;
    border-radius:10px;
    width:100%;
    max-width:400px;
}
#popup textarea, #popup input { margin-bottom:5px; }
#popupResult { margin:5px 0; font-weight:bold; }
</style>
</head>
<body>
<h1>📄 Mes Documents</h1>

<!-- CV -->
<section id="cvDoc">
<h2>CV</h2>
<div class="cv-photo-preview" id="cvPhotoPreview">Importer photo</div>
<input type="file" id="cvPhotoInput" accept="image/*">
<h3 style="text-align:center;font-weight:bold;font-size:20px;" id="cvName">Nom Complet</h3>
<p style="text-align:center;font-size:14px;" id="cvProfession">Profession</p>
<input id="cvPrenom" placeholder="Prénom">
<input id="cvNom" placeholder="Nom">
<input id="cvAge" placeholder="Âge">
<input id="cvVille" placeholder="Ville">
<input id="cvQuartier" placeholder="Quartier">
<input id="cvSituation" placeholder="Situation matrimoniale">
<input id="cvEnfants" placeholder="Nombre d'enfants">
<input id="cvPoste" placeholder="Dernier poste">
<input id="cvLoisirs" placeholder="Loisirs">
<input id="cvCaractere" placeholder="Caractère">
<input id="cvDiplome" placeholder="Dernier diplôme">
<input id="cvEtablissement" placeholder="Établissement">
<input id="cvAlcool" placeholder="Alcoolique Oui/Non">
<input id="cvSalaire" placeholder="Salaire">
<input id="cvEmail" placeholder="Email">
<input id="cvTelMtn" placeholder="Tel MTN">
<input id="cvTelOrange" placeholder="Tel Orange">
<canvas id="cvCanvas" class="signature-canvas"></canvas>
<div class="flex-row">
<button class="primary" onclick="openPaymentPopup('cvDoc','pdf')">📄 Télécharger PDF</button>
<button class="primary" onclick="openPaymentPopup('cvDoc','wa')">📤 Partager WhatsApp</button>
</div>
</section>

<!-- Lettre -->
<section id="lettreDoc">
<h2>✉️ Lettre de Motivation</h2>
<input id="lettrePrenom" placeholder="Prénom">
<input id="lettreNom" placeholder="Nom">
<input id="lettreEntreprise" placeholder="Entreprise">
<input id="lettrePoste" placeholder="Poste souhaité">
<textarea id="lettreContenu" placeholder="Contenu de la lettre"></textarea>
<canvas id="lettreCanvas" class="signature-canvas"></canvas>
<div class="flex-row">
<button class="primary" onclick="openPaymentPopup('lettreDoc','pdf')">📄 Télécharger PDF</button>
<button class="primary" onclick="openPaymentPopup('lettreDoc','wa')">📤 Partager WhatsApp</button>
</div>
</section>

<!-- Plan de localisation -->
<section id="planDoc">
<h2>🗺️ Plan de Localisation</h2>
<textarea id="planContenu" placeholder="Saisir le plan de localisation"></textarea>
<canvas id="planCanvas" class="signature-canvas"></canvas>
<div class="flex-row">
<button class="primary" onclick="openPaymentPopup('planDoc','pdf')">📄 Télécharger PDF</button>
<button class="primary" onclick="openPaymentPopup('planDoc','wa')">📤 Partager WhatsApp</button>
</div>
</section>

<!-- Popup paiement -->
<div id="popupOverlay">
<div id="popup">
<h2>Paiement requis</h2>
<p>Bénéficiaire: Wirnkar Loveline</p>
<p>Numéros: 690000000 / 650000000</p>
<p>Montant unitaire: 100 FCFA / heure</p>
<div class="flex-row">
<label>Multiplier: <span id="multiplierDisplay">1</span></label>
<button onclick="incrementMultiplier()">+</button>
<button onclick="decrementMultiplier()">-</button>
</div>
<textarea id="momoMsg" placeholder="Message Mobile Money"></textarea>
<input id="transactionId" placeholder="ID de transaction">
<input id="adminCode" type="password" placeholder="Code admin">
<div id="popupResult"></div>
<p>Temps restant: <span id="remainingTime">0 min</span></p>
<div class="flex-row">
<button class="primary" onclick="validatePayment()">✅ Valider</button>
<button onclick="closePopup()">Annuler</button>
</div>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><script>
// ==================== Photo CV ====================
const cvPhotoInput = document.getElementById('cvPhotoInput');
const cvPhotoPreview = document.getElementById('cvPhotoPreview');
cvPhotoInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = function(evt){
            cvPhotoPreview.style.backgroundImage = `url(${evt.target.result})`;
            cvPhotoPreview.textContent = '';
        }
        reader.readAsDataURL(file);
    }
});

// ==================== Signature ====================
function enableSignature(canvasId){
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d');
    let drawing = false;
    canvas.addEventListener('mousedown', e => { drawing=true; ctx.moveTo(e.offsetX,e.offsetY); });
    canvas.addEventListener('mousemove', e => { if(drawing){ ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke(); } });
    canvas.addEventListener('mouseup', () => drawing=false);
    canvas.addEventListener('mouseout', () => drawing=false);
}
enableSignature('cvCanvas');
enableSignature('lettreCanvas');
enableSignature('planCanvas');

// ==================== Popup Paiement ====================
let popupTarget = '';
let popupType = '';
let multiplier = 1;
let remainingMinutes = 10; // exemple de temps dispo

function openPaymentPopup(targetId,type){
    popupTarget = targetId;
    popupType = type;
    multiplier = 1;
    document.getElementById('multiplierDisplay').textContent = multiplier;
    document.getElementById('remainingTime').textContent = remainingMinutes + ' min';
    document.getElementById('popupOverlay').style.display='flex';
    document.getElementById('popupResult').textContent='';
}
function closePopup(){
    document.getElementById('popupOverlay').style.display='none';
}
function incrementMultiplier(){ multiplier++; document.getElementById('multiplierDisplay').textContent=multiplier; }
function decrementMultiplier(){ if(multiplier>1) multiplier--; document.getElementById('multiplierDisplay').textContent=multiplier; }

// ==================== Validation Paiement ====================
function validatePayment(){
    const msg = document.getElementById('momoMsg').value.trim();
    const id = document.getElementById('transactionId').value.trim();
    const admin = document.getElementById('adminCode').value.trim();
    if(msg && id && admin){
        document.getElementById('popupResult').textContent = `Paiement validé: ${multiplier*100} FCFA`;
        setTimeout(() => { closePopup(); generatePDF(popupTarget); }, 500);
        remainingMinutes -= multiplier; // réduit le temps dispo
    } else {
        document.getElementById('popupResult').textContent = 'Remplir tous les champs !';
    }
}

// ==================== Génération PDF ====================
async function generatePDF(targetId){
    const { jsPDF } = window.jspdf;
    const docSection = document.getElementById(targetId);
    const canvas = await html2canvas(docSection, {scale:2});
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p','mm','a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    pdf.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);
    pdf.save(`${targetId}.pdf`);
}

// ==================== Partage WhatsApp ====================
function shareWhatsApp(targetId){
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent("Voici mon document: "+targetId);
    window.open(`https://wa.me/?text=${text}%20${url}`,'_blank');
}

// Relier boutons WA avec popup
document.querySelectorAll('button[onclick*="wa"]').forEach(btn=>{
    btn.addEventListener('click', e=>{
        const targetId = btn.getAttribute('onclick').match(/'(\w+)'/)[1];
        shareWhatsApp(targetId);
    });
});
</script>
</body>
</html>